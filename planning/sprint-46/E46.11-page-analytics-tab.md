# E46.11 - Page Analytics Tab

## Resumo

Criar a pagina que integra todos os componentes de Market Intelligence em uma aba de Analytics dentro do modulo de Grupos.

## Contexto

Esta pagina sera acessivel via `/chips?tab=grupos` → aba "Analytics", combinando todos os componentes criados nos epicos anteriores (KPICard, VolumeChart, PipelineFunnel, GroupsRanking) em um dashboard coeso.

## Escopo

### Incluido
- Tab "Analytics" no modulo de Grupos
- Layout responsivo com grid
- Seletor de periodo
- Botao de refresh
- Integracao de todos os componentes
- Testes de integracao

### Excluido
- Export de dados
- Filtros avancados (sera sprint futura)

---

## Especificacao Tecnica

### Localizacao

```
/chips?tab=grupos → Tab "Analytics"
```

### Componentes na Pagina

1. **Header**
   - Seletor de periodo (7d, 30d, 90d, custom)
   - Botao de refresh
   - Indicador de ultima atualizacao

2. **KPIs Row** (4 KPICards)
   - Grupos Ativos
   - Vagas/Dia
   - Taxa de Conversao
   - Valor Medio

3. **Charts Row**
   - VolumeChart (2/3 da largura)
   - PipelineFunnel (1/3 da largura)

4. **Bottom Row**
   - GroupsRanking (full width)

---

## Implementacao

### Arquivo: `dashboard/components/market-intelligence/analytics-tab-content.tsx`

```typescript
/**
 * AnalyticsTabContent - Sprint 46
 *
 * Conteudo da aba Analytics no modulo de Grupos.
 */

'use client'

import { useMarketIntelligence } from '@/hooks/use-market-intelligence'
import { KPICard } from './kpi-card'
import { VolumeChart } from './volume-chart'
import { PipelineFunnel } from './pipeline-funnel'
import { GroupsRanking } from './groups-ranking'
import { PeriodSelector } from './period-selector'
import { Button } from '@/components/ui/button'
import { Skeleton } from '@/components/ui/skeleton'
import { RefreshCw, Clock, AlertCircle } from 'lucide-react'
import { cn } from '@/lib/utils'
import type { AnalyticsPeriod } from '@/types/market-intelligence'

// =============================================================================
// TYPES
// =============================================================================

export interface AnalyticsTabContentProps {
  className?: string
}

// =============================================================================
// HELPERS
// =============================================================================

function formatLastUpdated(date: Date | null): string {
  if (!date) return ''
  return date.toLocaleTimeString('pt-BR', {
    hour: '2-digit',
    minute: '2-digit',
  })
}

// =============================================================================
// SUBCOMPONENTS
// =============================================================================

function LoadingState() {
  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex items-center justify-between">
        <Skeleton className="h-10 w-48" />
        <Skeleton className="h-10 w-32" />
      </div>

      {/* KPIs */}
      <div className="grid gap-4 sm:grid-cols-2 lg:grid-cols-4">
        {Array.from({ length: 4 }).map((_, i) => (
          <Skeleton key={i} className="h-32" />
        ))}
      </div>

      {/* Charts */}
      <div className="grid gap-4 lg:grid-cols-3">
        <Skeleton className="h-[350px] lg:col-span-2" />
        <Skeleton className="h-[350px]" />
      </div>

      {/* Ranking */}
      <Skeleton className="h-[400px]" />
    </div>
  )
}

function ErrorState({ error, onRetry }: { error: Error; onRetry: () => void }) {
  return (
    <div className="flex min-h-[400px] flex-col items-center justify-center gap-4 text-center">
      <AlertCircle className="h-12 w-12 text-destructive" />
      <div>
        <h3 className="text-lg font-semibold">Erro ao carregar dados</h3>
        <p className="text-muted-foreground">{error.message}</p>
      </div>
      <Button onClick={onRetry} variant="outline">
        <RefreshCw className="mr-2 h-4 w-4" />
        Tentar novamente
      </Button>
    </div>
  )
}

// =============================================================================
// MAIN COMPONENT
// =============================================================================

export function AnalyticsTabContent({ className }: AnalyticsTabContentProps) {
  const {
    overview,
    volume,
    pipeline,
    isLoading,
    isRefreshing,
    error,
    refresh,
    setPeriod,
    setCustomPeriod,
    lastUpdated,
    period,
  } = useMarketIntelligence()

  // Handler para mudanca de periodo
  const handlePeriodChange = (newPeriod: AnalyticsPeriod) => {
    setPeriod(newPeriod)
  }

  // Handler para periodo customizado
  const handleCustomPeriod = (startDate: string, endDate: string) => {
    setCustomPeriod(startDate, endDate)
  }

  // Loading inicial
  if (isLoading && !overview) {
    return <LoadingState />
  }

  // Erro
  if (error && !overview) {
    return <ErrorState error={error} onRetry={refresh} />
  }

  return (
    <div className={cn('space-y-6', className)}>
      {/* Header */}
      <div className="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
        <PeriodSelector
          value={period}
          onChange={handlePeriodChange}
          onCustomChange={handleCustomPeriod}
        />

        <div className="flex items-center gap-4">
          {lastUpdated && (
            <div className="flex items-center gap-1 text-sm text-muted-foreground">
              <Clock className="h-4 w-4" />
              <span>Atualizado as {formatLastUpdated(lastUpdated)}</span>
            </div>
          )}

          <Button
            variant="outline"
            size="sm"
            onClick={refresh}
            disabled={isRefreshing}
          >
            <RefreshCw className={cn('mr-2 h-4 w-4', isRefreshing && 'animate-spin')} />
            {isRefreshing ? 'Atualizando...' : 'Atualizar'}
          </Button>
        </div>
      </div>

      {/* KPIs */}
      <div className="grid gap-4 sm:grid-cols-2 lg:grid-cols-4">
        <KPICard
          title="Grupos Ativos"
          value={overview?.kpis.gruposAtivos.valorFormatado ?? '-'}
          variacao={overview?.kpis.gruposAtivos.variacao ?? null}
          variacaoTipo={overview?.kpis.gruposAtivos.variacaoTipo ?? null}
          tendencia={overview?.kpis.gruposAtivos.tendencia}
          isLoading={isRefreshing}
        />
        <KPICard
          title="Vagas por Dia"
          value={overview?.kpis.vagasPorDia.valorFormatado ?? '-'}
          variacao={overview?.kpis.vagasPorDia.variacao ?? null}
          variacaoTipo={overview?.kpis.vagasPorDia.variacaoTipo ?? null}
          tendencia={overview?.kpis.vagasPorDia.tendencia}
          isLoading={isRefreshing}
        />
        <KPICard
          title="Taxa de Conversao"
          value={overview?.kpis.taxaConversao.valorFormatado ?? '-'}
          variacao={overview?.kpis.taxaConversao.variacao ?? null}
          variacaoTipo={overview?.kpis.taxaConversao.variacaoTipo ?? null}
          tendencia={overview?.kpis.taxaConversao.tendencia}
          isLoading={isRefreshing}
        />
        <KPICard
          title="Valor Medio"
          value={overview?.kpis.valorMedio.valorFormatado ?? '-'}
          variacao={overview?.kpis.valorMedio.variacao ?? null}
          variacaoTipo={overview?.kpis.valorMedio.variacaoTipo ?? null}
          tendencia={overview?.kpis.valorMedio.tendencia}
          isLoading={isRefreshing}
        />
      </div>

      {/* Charts */}
      <div className="grid gap-4 lg:grid-cols-3">
        <div className="lg:col-span-2">
          <VolumeChart
            data={volume?.dados ?? null}
            isLoading={isRefreshing}
          />
        </div>
        <div>
          <PipelineFunnel
            data={pipeline?.funil ?? null}
            perdas={pipeline?.perdas}
            isLoading={isRefreshing}
            showPerdas={false}
          />
        </div>
      </div>

      {/* Pipeline detalhado + Ranking */}
      <div className="grid gap-4 lg:grid-cols-2">
        <PipelineFunnel
          data={pipeline?.funil ?? null}
          perdas={pipeline?.perdas}
          isLoading={isRefreshing}
          title="Detalhes do Pipeline"
        />
        <GroupsRanking
          data={null} // TODO: Integrar com API de ranking
          isLoading={isRefreshing}
          limit={5}
          title="Top 5 Grupos"
        />
      </div>
    </div>
  )
}

export default AnalyticsTabContent
```

### Arquivo: `dashboard/components/market-intelligence/period-selector.tsx`

```typescript
/**
 * PeriodSelector - Sprint 46
 *
 * Seletor de periodo para filtrar dados de Market Intelligence.
 */

'use client'

import { useState } from 'react'
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import {
  Popover,
  PopoverContent,
  PopoverTrigger,
} from '@/components/ui/popover'
import { Calendar } from 'lucide-react'
import type { AnalyticsPeriod } from '@/types/market-intelligence'

// =============================================================================
// TYPES
// =============================================================================

export interface PeriodSelectorProps {
  value: AnalyticsPeriod
  onChange: (period: AnalyticsPeriod) => void
  onCustomChange?: (startDate: string, endDate: string) => void
}

// =============================================================================
// CONSTANTS
// =============================================================================

const PERIOD_OPTIONS = [
  { value: '7d', label: 'Ultimos 7 dias' },
  { value: '30d', label: 'Ultimos 30 dias' },
  { value: '90d', label: 'Ultimos 90 dias' },
  { value: 'custom', label: 'Personalizado' },
] as const

// =============================================================================
// MAIN COMPONENT
// =============================================================================

export function PeriodSelector({ value, onChange, onCustomChange }: PeriodSelectorProps) {
  const [customStart, setCustomStart] = useState('')
  const [customEnd, setCustomEnd] = useState('')
  const [isPopoverOpen, setIsPopoverOpen] = useState(false)

  const handlePeriodChange = (newValue: string) => {
    if (newValue === 'custom') {
      setIsPopoverOpen(true)
    } else {
      onChange(newValue as AnalyticsPeriod)
    }
  }

  const handleApplyCustom = () => {
    if (customStart && customEnd && onCustomChange) {
      onCustomChange(customStart, customEnd)
      setIsPopoverOpen(false)
    }
  }

  return (
    <div className="flex items-center gap-2">
      <Select value={value} onValueChange={handlePeriodChange}>
        <SelectTrigger className="w-[180px]">
          <SelectValue placeholder="Selecionar periodo" />
        </SelectTrigger>
        <SelectContent>
          {PERIOD_OPTIONS.map((option) => (
            <SelectItem key={option.value} value={option.value}>
              {option.label}
            </SelectItem>
          ))}
        </SelectContent>
      </Select>

      {value === 'custom' && (
        <Popover open={isPopoverOpen} onOpenChange={setIsPopoverOpen}>
          <PopoverTrigger asChild>
            <Button variant="outline" size="icon">
              <Calendar className="h-4 w-4" />
            </Button>
          </PopoverTrigger>
          <PopoverContent className="w-80">
            <div className="grid gap-4">
              <div className="space-y-2">
                <h4 className="font-medium">Periodo Personalizado</h4>
                <p className="text-sm text-muted-foreground">
                  Selecione o intervalo de datas
                </p>
              </div>
              <div className="grid gap-2">
                <div className="grid grid-cols-3 items-center gap-4">
                  <Label htmlFor="start">Inicio</Label>
                  <Input
                    id="start"
                    type="date"
                    className="col-span-2"
                    value={customStart}
                    onChange={(e) => setCustomStart(e.target.value)}
                  />
                </div>
                <div className="grid grid-cols-3 items-center gap-4">
                  <Label htmlFor="end">Fim</Label>
                  <Input
                    id="end"
                    type="date"
                    className="col-span-2"
                    value={customEnd}
                    onChange={(e) => setCustomEnd(e.target.value)}
                  />
                </div>
              </div>
              <Button
                onClick={handleApplyCustom}
                disabled={!customStart || !customEnd}
              >
                Aplicar
              </Button>
            </div>
          </PopoverContent>
        </Popover>
      )}
    </div>
  )
}

export default PeriodSelector
```

### Arquivo: `dashboard/components/market-intelligence/index.ts`

```typescript
/**
 * Market Intelligence Components - Sprint 46
 *
 * Barrel export de todos os componentes.
 */

export { KPICard } from './kpi-card'
export { VolumeChart } from './volume-chart'
export { PipelineFunnel } from './pipeline-funnel'
export { GroupsRanking } from './groups-ranking'
export { PeriodSelector } from './period-selector'
export { AnalyticsTabContent } from './analytics-tab-content'

export type { KPICardProps } from './kpi-card'
export type { VolumeChartProps } from './volume-chart'
export type { PipelineFunnelProps } from './pipeline-funnel'
export type { GroupsRankingProps } from './groups-ranking'
export type { PeriodSelectorProps } from './period-selector'
export type { AnalyticsTabContentProps } from './analytics-tab-content'
```

---

## Testes

### Arquivo: `dashboard/__tests__/components/market-intelligence/analytics-tab-content.test.tsx`

```typescript
/**
 * Testes de Integracao - AnalyticsTabContent
 */

import { render, screen, waitFor, fireEvent } from '@testing-library/react'
import userEvent from '@testing-library/user-event'
import { AnalyticsTabContent } from '@/components/market-intelligence/analytics-tab-content'

// Mock do hook
jest.mock('@/hooks/use-market-intelligence', () => ({
  useMarketIntelligence: jest.fn(),
}))

// Mock dos componentes filhos para simplificar testes
jest.mock('@/components/market-intelligence/kpi-card', () => ({
  KPICard: ({ title, value }: { title: string; value: string }) => (
    <div data-testid="kpi-card">
      <span>{title}</span>
      <span>{value}</span>
    </div>
  ),
}))

jest.mock('@/components/market-intelligence/volume-chart', () => ({
  VolumeChart: ({ isLoading }: { isLoading: boolean }) => (
    <div data-testid="volume-chart" data-loading={isLoading} />
  ),
}))

jest.mock('@/components/market-intelligence/pipeline-funnel', () => ({
  PipelineFunnel: ({ title }: { title?: string }) => (
    <div data-testid="pipeline-funnel">{title}</div>
  ),
}))

jest.mock('@/components/market-intelligence/groups-ranking', () => ({
  GroupsRanking: ({ title }: { title?: string }) => (
    <div data-testid="groups-ranking">{title}</div>
  ),
}))

import { useMarketIntelligence } from '@/hooks/use-market-intelligence'

// =============================================================================
// TEST DATA
// =============================================================================

const mockOverview = {
  kpis: {
    gruposAtivos: { valor: 50, valorFormatado: '50', variacao: 10, variacaoTipo: 'up', tendencia: [45, 50] },
    vagasPorDia: { valor: 8.5, valorFormatado: '8.5/dia', variacao: 5, variacaoTipo: 'up', tendencia: [8, 8.5] },
    taxaConversao: { valor: 65, valorFormatado: '65%', variacao: -2, variacaoTipo: 'down', tendencia: [67, 65] },
    valorMedio: { valor: 1500, valorFormatado: 'R$ 1.500', variacao: null, variacaoTipo: null, tendencia: [1500] },
  },
}

const mockVolume = {
  dados: [{ data: '2024-01-01', mensagens: 100, ofertas: 30, vagasExtraidas: 20, vagasImportadas: 15 }],
}

const mockPipeline = {
  funil: {
    etapas: [{ id: 'mensagens', nome: 'Mensagens', valor: 1000, percentual: 100 }],
    conversoes: { mensagemParaOferta: 30, ofertaParaExtracao: 66, extracaoParaImportacao: 75, totalPipeline: 15 },
  },
  perdas: { duplicadas: 10, descartadas: 5, revisao: 3, semDadosMinimos: 7 },
}

const mockHookReturn = {
  overview: mockOverview,
  volume: mockVolume,
  pipeline: mockPipeline,
  isLoading: false,
  isRefreshing: false,
  error: null,
  refresh: jest.fn(),
  setPeriod: jest.fn(),
  setCustomPeriod: jest.fn(),
  lastUpdated: new Date('2024-01-31T12:00:00Z'),
  period: '30d' as const,
  customDates: null,
}

// =============================================================================
// TESTS
// =============================================================================

describe('AnalyticsTabContent', () => {
  beforeEach(() => {
    jest.clearAllMocks()
    ;(useMarketIntelligence as jest.Mock).mockReturnValue(mockHookReturn)
  })

  describe('Renderizacao', () => {
    it('deve renderizar todos os componentes principais', () => {
      render(<AnalyticsTabContent />)

      // KPI Cards
      expect(screen.getAllByTestId('kpi-card')).toHaveLength(4)

      // Charts
      expect(screen.getByTestId('volume-chart')).toBeInTheDocument()

      // Pipeline
      expect(screen.getAllByTestId('pipeline-funnel')).toHaveLength(2) // 1 no grid + 1 detalhado

      // Ranking
      expect(screen.getByTestId('groups-ranking')).toBeInTheDocument()
    })

    it('deve renderizar o seletor de periodo', () => {
      render(<AnalyticsTabContent />)

      expect(screen.getByRole('combobox')).toBeInTheDocument()
    })

    it('deve renderizar o botao de refresh', () => {
      render(<AnalyticsTabContent />)

      expect(screen.getByRole('button', { name: /atualizar/i })).toBeInTheDocument()
    })

    it('deve exibir horario da ultima atualizacao', () => {
      render(<AnalyticsTabContent />)

      expect(screen.getByText(/atualizado as/i)).toBeInTheDocument()
    })

    it('deve aplicar className customizado', () => {
      const { container } = render(<AnalyticsTabContent className="custom-class" />)

      expect(container.firstChild).toHaveClass('custom-class')
    })
  })

  describe('Loading State', () => {
    it('deve mostrar loading quando isLoading=true e nao tem dados', () => {
      ;(useMarketIntelligence as jest.Mock).mockReturnValue({
        ...mockHookReturn,
        isLoading: true,
        overview: null,
      })

      render(<AnalyticsTabContent />)

      // Nao deve mostrar componentes, deve mostrar skeletons
      expect(screen.queryByTestId('kpi-card')).not.toBeInTheDocument()
    })
  })

  describe('Error State', () => {
    it('deve mostrar erro quando ha erro e nao tem dados', () => {
      ;(useMarketIntelligence as jest.Mock).mockReturnValue({
        ...mockHookReturn,
        error: new Error('Falha na API'),
        overview: null,
      })

      render(<AnalyticsTabContent />)

      expect(screen.getByText(/erro ao carregar dados/i)).toBeInTheDocument()
      expect(screen.getByText(/falha na api/i)).toBeInTheDocument()
    })

    it('deve ter botao de retry no erro', async () => {
      const mockRefresh = jest.fn()
      ;(useMarketIntelligence as jest.Mock).mockReturnValue({
        ...mockHookReturn,
        error: new Error('Falha'),
        overview: null,
        refresh: mockRefresh,
      })

      const user = userEvent.setup()
      render(<AnalyticsTabContent />)

      const retryBtn = screen.getByRole('button', { name: /tentar novamente/i })
      await user.click(retryBtn)

      expect(mockRefresh).toHaveBeenCalled()
    })
  })

  describe('Refresh', () => {
    it('deve chamar refresh ao clicar no botao', async () => {
      const mockRefresh = jest.fn()
      ;(useMarketIntelligence as jest.Mock).mockReturnValue({
        ...mockHookReturn,
        refresh: mockRefresh,
      })

      const user = userEvent.setup()
      render(<AnalyticsTabContent />)

      const refreshBtn = screen.getByRole('button', { name: /atualizar/i })
      await user.click(refreshBtn)

      expect(mockRefresh).toHaveBeenCalled()
    })

    it('deve desabilitar botao durante refresh', () => {
      ;(useMarketIntelligence as jest.Mock).mockReturnValue({
        ...mockHookReturn,
        isRefreshing: true,
      })

      render(<AnalyticsTabContent />)

      const refreshBtn = screen.getByRole('button', { name: /atualizando/i })
      expect(refreshBtn).toBeDisabled()
    })

    it('deve mostrar spinner durante refresh', () => {
      ;(useMarketIntelligence as jest.Mock).mockReturnValue({
        ...mockHookReturn,
        isRefreshing: true,
      })

      render(<AnalyticsTabContent />)

      expect(screen.getByText('Atualizando...')).toBeInTheDocument()
    })
  })

  describe('Period Selector', () => {
    it('deve chamar setPeriod ao mudar periodo', async () => {
      const mockSetPeriod = jest.fn()
      ;(useMarketIntelligence as jest.Mock).mockReturnValue({
        ...mockHookReturn,
        setPeriod: mockSetPeriod,
      })

      const user = userEvent.setup()
      render(<AnalyticsTabContent />)

      const select = screen.getByRole('combobox')
      await user.click(select)

      const option7d = screen.getByText('Ultimos 7 dias')
      await user.click(option7d)

      expect(mockSetPeriod).toHaveBeenCalledWith('7d')
    })
  })

  describe('KPI Cards', () => {
    it('deve passar valores corretos para KPI cards', () => {
      render(<AnalyticsTabContent />)

      const kpiCards = screen.getAllByTestId('kpi-card')
      expect(kpiCards).toHaveLength(4)

      expect(screen.getByText('Grupos Ativos')).toBeInTheDocument()
      expect(screen.getByText('50')).toBeInTheDocument()
      expect(screen.getByText('Vagas por Dia')).toBeInTheDocument()
      expect(screen.getByText('8.5/dia')).toBeInTheDocument()
    })
  })

  describe('Layout Responsivo', () => {
    it('deve usar grid para KPIs', () => {
      const { container } = render(<AnalyticsTabContent />)

      const kpiContainer = container.querySelector('.grid.sm\\:grid-cols-2.lg\\:grid-cols-4')
      expect(kpiContainer).toBeInTheDocument()
    })

    it('deve usar grid para charts', () => {
      const { container } = render(<AnalyticsTabContent />)

      const chartContainer = container.querySelector('.grid.lg\\:grid-cols-3')
      expect(chartContainer).toBeInTheDocument()
    })
  })
})
```

### Arquivo: `dashboard/__tests__/components/market-intelligence/period-selector.test.tsx`

```typescript
/**
 * Testes Unitarios - PeriodSelector
 */

import { render, screen } from '@testing-library/react'
import userEvent from '@testing-library/user-event'
import { PeriodSelector } from '@/components/market-intelligence/period-selector'

describe('PeriodSelector', () => {
  const mockOnChange = jest.fn()
  const mockOnCustomChange = jest.fn()

  beforeEach(() => {
    jest.clearAllMocks()
  })

  it('deve renderizar com valor selecionado', () => {
    render(<PeriodSelector value="30d" onChange={mockOnChange} />)

    expect(screen.getByRole('combobox')).toBeInTheDocument()
  })

  it('deve chamar onChange ao selecionar periodo', async () => {
    const user = userEvent.setup()
    render(<PeriodSelector value="30d" onChange={mockOnChange} />)

    const select = screen.getByRole('combobox')
    await user.click(select)

    const option = screen.getByText('Ultimos 7 dias')
    await user.click(option)

    expect(mockOnChange).toHaveBeenCalledWith('7d')
  })

  it('deve ter todas as opcoes de periodo', async () => {
    const user = userEvent.setup()
    render(<PeriodSelector value="30d" onChange={mockOnChange} />)

    await user.click(screen.getByRole('combobox'))

    expect(screen.getByText('Ultimos 7 dias')).toBeInTheDocument()
    expect(screen.getByText('Ultimos 30 dias')).toBeInTheDocument()
    expect(screen.getByText('Ultimos 90 dias')).toBeInTheDocument()
    expect(screen.getByText('Personalizado')).toBeInTheDocument()
  })

  it('deve mostrar popover de datas ao selecionar custom', async () => {
    const user = userEvent.setup()
    render(
      <PeriodSelector value="30d" onChange={mockOnChange} onCustomChange={mockOnCustomChange} />
    )

    await user.click(screen.getByRole('combobox'))
    await user.click(screen.getByText('Personalizado'))

    expect(screen.getByText('Periodo Personalizado')).toBeInTheDocument()
  })
})
```

---

## Definition of Done (DoD)

### Checklist Obrigatorio

- [ ] Arquivo `analytics-tab-content.tsx` criado
- [ ] Arquivo `period-selector.tsx` criado
- [ ] Arquivo `index.ts` com barrel exports criado
- [ ] Integra useMarketIntelligence hook
- [ ] Renderiza 4 KPI cards
- [ ] Renderiza VolumeChart
- [ ] Renderiza PipelineFunnel (2x)
- [ ] Renderiza GroupsRanking
- [ ] PeriodSelector funciona
- [ ] Botao refresh funciona
- [ ] Loading state funciona
- [ ] Error state funciona
- [ ] Layout responsivo
- [ ] Testes de integracao escritos
- [ ] Cobertura de testes >= 80%
- [ ] Zero erros de TypeScript

### Comandos de Verificacao

```bash
# Rodar testes
npm run test -- __tests__/components/market-intelligence/analytics-tab-content.test.tsx

# Verificar cobertura
npm run test -- __tests__/components/market-intelligence/ --coverage

# Type check
npm run type-check
```

---

## Criterios de Aceitacao

| ID | Criterio | Verificacao |
|----|----------|-------------|
| AC1 | Tab existe | Navegar para aba Analytics |
| AC2 | KPIs renderizam | 4 cards visiveis |
| AC3 | Charts renderizam | VolumeChart e PipelineFunnel |
| AC4 | Ranking renderiza | GroupsRanking visivel |
| AC5 | Period selector | Muda e refaz fetch |
| AC6 | Refresh button | Chama refresh |
| AC7 | Loading state | Skeleton durante load |
| AC8 | Error state | Mensagem e retry |
| AC9 | Responsivo | Layout adapta |
| AC10 | Testes passam | npm run test passa |

---

## Integracao com Modulo Grupos

Adicionar a tab Analytics no componente de grupos:

```typescript
// Em dashboard/components/group-entry/group-entry-page-content.tsx

import { AnalyticsTabContent } from '@/components/market-intelligence'

// Dentro do Tabs:
<TabsContent value="analytics">
  <AnalyticsTabContent />
</TabsContent>
```

---

## Notas para o Desenvolvedor

1. **Integracao**: Tab deve ser adicionada ao modulo Grupos existente
2. **Hook**: useMarketIntelligence gerencia todo o estado
3. **Layout**: Grid responsivo com breakpoints sm/lg
4. **Performance**: Dados ja memoizados no hook
5. **Error Handling**: Mostrar UI de erro com retry
